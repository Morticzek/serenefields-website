---
// components/ui/store/NicknameModal.astro
---
<div id="nickname-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-neutral-800 p-6 rounded-lg shadow-xl max-w-md w-full">
        <h2 class="text-2xl font-bold text-white mb-4">Enter Your Minecraft Nickname</h2>
        <form id="nickname-form" class="space-y-4">
            <div>
                <input
                        type="text"
                        id="nickname-input"
                        class="w-full p-2 rounded bg-neutral-700 text-white border border-gray-600 focus:border-yellow-500 focus:outline-none"
                        placeholder="Your Minecraft nickname"
                        required
                        pattern="[a-zA-Z0-9_]{2,16}"
                        title="Minecraft nickname (2-16 characters, alphanumeric and underscore only)"
                >
            </div>
            <button
                    type="submit"
                    class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-2 px-4 rounded transition-colors"
            >
                Continue Shopping
            </button>
        </form>
    </div>
</div>

<script>
    function hideModal() {
        const modal = document.getElementById('nickname-modal');
        if (modal) {
            modal.style.display = 'none';
        }
    }

    function showModal() {
        const modal = document.getElementById('nickname-modal');
        if (modal) {
            modal.style.display = 'flex';
        }
    }

    // Initial check
    const savedNickname = localStorage.getItem('minecraft-nickname');
    if (!savedNickname) {
        showModal();
    }

    // Form submission
    const form = document.getElementById('nickname-form');
    form?.addEventListener('submit', (e) => {
        e.preventDefault();
        const input = document.getElementById('nickname-input') as HTMLInputElement;
        const nickname = input.value.trim();

        if (nickname) {
            localStorage.setItem('minecraft-nickname', nickname);
            hideModal();
            window.dispatchEvent(new CustomEvent('nickname-set', {
                detail: { nickname }
            }));
        }
    });

    // Listen for show-nickname-modal event
    window.addEventListener('show-nickname-modal', () => {
        const input = document.getElementById('nickname-input') as HTMLInputElement;
        if (input) {
            input.value = localStorage.getItem('minecraft-nickname') || '';
        }
        showModal();
    });
</script>
