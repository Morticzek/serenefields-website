---
import '@/assets/styles/globals.css';
import '@/assets/styles/tailwind.css';
import StoreHeader from '../components/ui/store/StoreHeader.astro';
import StoreGrid from '../components/ui/store/StoreGrid.astro';
import MainLayout from "../layouts/MainLayout.astro";
import {
    extractPerksFromDescription,
    getCategoryBorder,
    getCategoryColor,
    tebexApi,
    transformPackageData
} from '../utils/tebex';

import Tier1 from '../assets/image/products/rank_lord.webp?url';
import Tier2 from '../assets/image/products/rank_baron.webp?url';
import Tier3 from '../assets/image/products/rank_duke.webp?url';
import Tier4 from '../assets/image/products/rank_land_grant.webp?url';
import StoreFAQ from "../components/ui/store/StoreFAQ.astro";
import ShoppingCart from "../components/ui/store/ShoppingCart.astro";

const categories = await tebexApi.getStoreData();
const products = categories[0].packages.map(pkg => ({
    name: pkg.name,
    description: pkg.description.replace(/<\/?p>/g, ''), // Remove <p> tags
    image: pkg.image,
    base_price: pkg.base_price,
    sales_tax: pkg.sales_tax,
    total_price: pkg.total_price,
    currency: pkg.currency,
    color: getCategoryColor(pkg.name),
    border: getCategoryBorder(pkg.name),
    tebexId: pkg.id
}));

function getCategoryColor(packageName: string): string {
    const colors = {
        'Lord Rank': 'text-[#85cb5d]',
        'Baron Rank': 'text-[#77a6ee]',
        'Duke Rank': 'text-[#dea95d]',
    };
    return colors[packageName] || 'text-gray-200';
}

function getCategoryBorder(packageName: string): string {
    const borders = {
        'Lord Rank': 'border-[#85cb5d]',
        'Baron Rank': 'border-[#77a6ee]',
        'Duke Rank': 'border-[#dea95d]',
    };
    return borders[packageName] || 'border-gray-200';
}

// Sample FAQ data
const faqs = [
    {
        question: 'How do I purchase a rank?',
        answer: 'To purchase a rank, click on the BUY button next to the rank you want and follow the instructions.'
    },
    {
        question: 'What payment methods are accepted?',
        answer: 'We accept various payment methods including credit cards, PayPal, and more.'
    },
    {
        question: 'Can I upgrade my rank?',
        answer: 'Yes, you can upgrade your rank at any time. Simply purchase the desired rank and the system will apply the upgrade.'
    },
    // Add more FAQs as needed
];
---

<MainLayout>
    <StoreHeader
            title="Welcome to the SereneFields Store"
            description="Take a look at our available ranks and subscriptions, granting you access to exclusive perks and features."
    />
    <StoreGrid products={products} />
    <StoreFAQ faqs={faqs} />
</MainLayout>
